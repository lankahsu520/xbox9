SOURCE_PREFIX=aws-sdk-cpp
#SOURCE_VERSION_GZ=git
#SOURCE_VERSION_GZ=1.10.9
SOURCE_VERSION_GZ=$(PJ_AWS_SDK_CPP_VERSION)
SOURCE=$(SOURCE_PREFIX)-$(SOURCE_VERSION_GZ)
GIT_SERVER=https://github.com/aws/aws-sdk-cpp.git
#AWS SDK for C++
#https://github.com/aws/aws-sdk-cpp

TOP = $(shell pwd)
PWD = $(shell pwd)

#CMAKE_VERBOSE="VERBOSE=1"
CMAKE_FLAGS = \
		-DENFORCE_SUBMODULE_VERSIONS=OFF \
		-DCMAKE_PREFIX_PATH=$(SDK_ROOT_DIR) \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DBUILD_ONLY="dynamodb;iam;s3;sts"
#		-DBUILD_ONLY="monitoring;logs;dynamodb;s3
#		-DCMAKE_BUILD_TYPE=Debug \
#		-DTARGET_ARCH=ANDROID

#** LIBXXX_yes **
LIBXXX_SO = \

#** Target (CLEAN_BINS) **
CLEAN_BINS = \

#** Target (DUMMY_BINS) **
DUMMY_BINS = \
						$(CLEAN_BINS)

#** Target (SHELL_SBINS) **
SHELL_SBINS = $(wildcard sh/*.sh)

DUMMY_SBINS = $(SHELL_SBINS)

.PHONY: all clean distclean install romfs
all: .configured
	@[ -d $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) ] && make -C $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) $(CMAKE_VERBOSE)

clean:
	@[ -d $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) ] && make -C $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) clean || echo -n ""

distclean:
	if [ -d $(SOURCE) ]; then \
		$(PJ_SH_RMDIR) $(SOURCE); \
	fi

.unpack:
	tar -xvf $(PJ_DOWNLOAD)/$(SOURCE).tar.* \
	|| git clone --recurse-submodules $(GIT_SERVER) $(SOURCE) \
	|| echo "unpack error !!! $(SOURCE)"
	touch $@

.patched: .unpack
	if [ -d patches/$(SOURCE) ]; then \
		$(PJ_SH_CP) patches/$(SOURCE)/* $(SOURCE); \
	fi
	cd $(SOURCE) \
	&& ./prefetch_crt_dependency.sh
	touch $@

.cmake: .patched
	cd $(SOURCE) \
	&& $(PJ_SH_MKDIR) cmake \
	&& $(PJ_SH_CP) $(PJ_CMAKE_CROSS) ./cmake/build.cmake
	touch $@

.configured: .cmake
	cd $(SOURCE) \
	&& $(PJ_SH_MKDIR) $(PJ_CMAKE_BUILD_DIR) \
	&& cd $(PJ_CMAKE_BUILD_DIR) \
	&& cmake \
		$(CMAKE_FLAGS) \
		$(PJ_CMAKE_FLAGS) \
		-DCMAKE_TOOLCHAIN_FILE=../cmake/build.cmake \
		-S ..
		#-DCMAKE_VERBOSE_MAKEFILE=ON \
		#-DCMAKE_MODULE_LINKER_FLAGS=-L$(SDK_LIB_DIR) \
		#-DCMAKE_INCLUDE_DIRECTORIES_PROJECT_BEFORE=$(SDK_INC_DIR)
		#-DOPENSSL_ROOT_DIR=$(SDK_ROOT_DIR) \
	touch $@

install:
	@[ -d $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) ] && make -C $(SOURCE)/$(PJ_CMAKE_BUILD_DIR) install || echo -n ""

romfs:
ifneq ("$(HOMEX_ROOT_DIR)", "")
	find -name lib*.so* | xargs -n1 -I {} $(PJ_SH_CP) {} $(HOMEX_LIB_DIR)

endif